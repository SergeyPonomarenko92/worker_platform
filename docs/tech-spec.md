# Технічне завдання (Tech Spec) — Worker Platform

> **Мета продукту:** веб‑додаток для України (UI — **українською**), який поєднує:
> - контент провайдера (портфоліо/пости + «історії») — як Instagram
> - каталог/пошук послуг і товарів — як OLX
> - відгуки/рейтинг лише після угоди — як Rozetka

---

## 0) Статус документа
- **Формат:** робоча спека (MVP-first)
- **Джерело істини по прогресу:** `docs/next-steps.md`

### 0.1 Поточний статус реалізації (as-is)
- ✅ Етап 0 — каркас (Laravel + Breeze Inertia)
- ✅ Етап 1 — доменні дані (моделі/міграції + сід категорій + демо‑дані)
- ✅ Етап 2 — кабінет провайдера:
  - multiple BusinessProfiles per user
  - offers scoped to BusinessProfile
  - owner-only policies
  - flash-messages у UI
- ✅ Етап 3 — контент:
  - ✅ CRUD у кабінеті для `PortfolioPost` та `Story`
  - ✅ на публічній сторінці провайдера портфоліо фільтрується за `published_at` (draft/scheduled не показуємо)
  - ✅ на публічній сторінці провайдера stories фільтруються за `expires_at > now()`
  - ✅ у кабінеті протерміновані stories приховані за замовчуванням (є перемикач показу)
- ✅ Етап 4 — угоди + відгуки:
  - ✅ провайдер вручну створює угоду у кабінеті (email клієнта, опційно офер)
  - ✅ зміна статусів: draft → in_progress → completed/cancelled
  - ✅ відгук після `completed` (policy + UI + tests) + відображення відгуків на публічній сторінці провайдера
- ✅ UX/Polish:
  - `/` редіректить на `/catalog`
  - UI/validation локаль: `uk`
  - форми показують помилки валідації через Inertia (без нативної HTML-валидації)

---

## 1) Терміни (глосарій)
- **Провайдер** — бізнес/майстер, який надає послуги або продає товари.
- **Клієнт** — користувач, який шукає послуги/товари.
- **Бізнес‑профіль (BusinessProfile)** — «вітрина» провайдера (публічна сторінка + реквізити).
- **Пропозиція (Offer)** — оголошення провайдера (послуга або товар).
- **Угода (Deal)** — факт взаємодії клієнта з провайдером із можливістю завершення.
- **Відгук (Review)** — оцінка провайдера клієнтом, доступна лише після завершеної угоди.

---

## 2) Персонажі та ролі
### 2.1 Персонажі
- **Гість:** неавторизований, переглядає каталог/провайдерів.
- **Клієнт:** авторизований, ініціює угоди, залишає відгуки.
- **Провайдер:** авторизований, керує бізнес‑профілями, пропозиціями, контентом.

### 2.2 Модель ролей (MVP)
На старті ролі не відокремлюються окремими таблицями/ролями — одна й та сама `User` може бути клієнтом і провайдером. Доступи обмежуються політиками (owner‑only) та наявністю сутностей.

---

## 3) Scope (MVP) / Non-goals
### 3.1 In scope (MVP)
- Аутентифікація (Laravel Breeze + Inertia Vue).
- Публічні сторінки:
  - `/catalog`
  - `/providers/{slug}`
- Кабінет провайдера:
  - CRUD **BusinessProfile** (зараз — **multiple business profiles per user**)
  - CRUD **Offer** у контексті вибраного бізнес‑профілю
- Авторизація:
  - тільки власник може редагувати свій бізнес‑профіль та його пропозиції.
- Flash‑повідомлення про успіх/помилки у UI.

### 3.2 Non-goals (після MVP)
- Повна модерація, антиспам, блокування.
- Платежі/оплати.
- Команди/співробітники в бізнесі.
- API-first мобільний клієнт.

---

## 4) Функціональні вимоги (user stories + acceptance criteria)

### 4.1 Каталог
**Story:** як гість/клієнт хочу переглядати каталог пропозицій, щоб знайти послугу/товар.

**Acceptance:**
- GET `/catalog` віддає список пропозицій.
- Є базові фільтри (мінімум: тип service/product) — *може бути наступним етапом, якщо не зроблено*.

### 4.2 Сторінка провайдера
**Story:** як гість/клієнт хочу бачити сторінку провайдера з пропозиціями та базовою інформацією.

**Acceptance:**
- GET `/providers/{slug}` відображає профіль провайдера.
- На сторінці є перелік офферів цього профілю.

### 4.3 Кабінет провайдера — бізнес‑профілі (multiple)
**Story:** як провайдер хочу мати кілька бізнес‑профілів (наприклад, різні бренди/напрями), щоб керувати ними окремо.

**Acceptance:**
- Провайдер бачить список своїх профілів: GET `/dashboard/business-profiles`.
- Може створити профіль: GET+POST `/dashboard/business-profiles/create` + `/dashboard/business-profiles`.
- Може редагувати свій профіль: GET+PATCH `/dashboard/business-profiles/{businessProfile}/edit` + `/dashboard/business-profiles/{businessProfile}`.
- Не може редагувати чужий профіль (403).

### 4.4 Кабінет провайдера — оффери (в контексті профілю)
**Story:** як провайдер хочу керувати пропозиціями конкретного бізнес‑профілю.

**Acceptance:**
- Index офферів профілю: GET `/dashboard/business-profiles/{businessProfile}/offers`.
- Create/Store: GET `/.../offers/create`, POST `/.../offers`.
- Edit/Update: GET `/.../offers/{offer}/edit`, PATCH `/.../offers/{offer}`.
- Delete: DELETE `/.../offers/{offer}`.
- Заборонено редагувати/видаляти оффери чужих профілів (403).
- Маршрути використовують `scopeBindings`, щоб `{offer}` належав `{businessProfile}`.

---

## 5) Матриця доступів (MVP)
| Дія | Гість | User | Власник BusinessProfile |
|---|---:|---:|---:|
| Перегляд каталогу | ✅ | ✅ | ✅ |
| Перегляд провайдера | ✅ | ✅ | ✅ |
| Список своїх бізнес‑профілів | ❌ | ✅ | ✅ |
| Створення бізнес‑профілю | ❌ | ✅ | ✅ |
| Редагування бізнес‑профілю | ❌ | ❌ | ✅ |
| CRUD офферів у профілі | ❌ | ❌ | ✅ |

> Примітка: «Власник» визначається через policy: `business_profiles.user_id === auth_user.id`.

---

## 6) Дані (Entities) та поля
### 6.1 BusinessProfile
- `user_id` (FK users)
- `name`, `slug`, `about`
- `country_code` (default UA), `city`, `address`
- `phone`, `website`
- `is_active`

### 6.2 Offer
- `business_profile_id` (FK business_profiles)
- `category_id` (FK categories)
- `type` = `service|product`
- `title`, `description`
- `price_from`, `price_to`, `currency` (default UAH)
- `is_active`

### 6.3 Category
- `parent_id`, `name`, `slug`

### 6.4 Deal / Review / Story / PortfolioPost (пізніше)
Опис див. `docs/mvp.md` та секцію «Етапи» нижче.

---

## 7) UI/UX вимоги
- Мова UI: **uk** (MVP).
- Після CRUD‑дій користувач бачить flash‑повідомлення `success` або `error`.
- Кабінет провайдера будується навколо вибору бізнес‑профілю.

---

## 8) Нефункціональні вимоги
- DB: Postgres рекомендовано (особливо для продакшну).
- Безпека: CSRF, auth (Breeze), policies для owner-only.
- Продуктивність: індекси на `slug`, `business_profile_id`, `category_id` (додати при рості даних).

---

## 9) Технічна реалізація (референси)
- Backend: Laravel (моноліт на старті)
- Frontend: Vue 3 через Inertia (Breeze)
- Assets: Vite + Tailwind
- Dev env: Laravel Sail (див. `docs/dev-setup.md`)

---

## 10) Етапи (roadmap)
### Етап 0 — Каркас (готово)
- Laravel + Breeze (Inertia Vue)
- Документи: `docs/mvp.md`, `docs/architecture.md`

### Етап 1 — Доменно‑дані (частково)
- Міграції + моделі
- Seed категорій

### Етап 2 — Кабінет провайдера (зроблено)
- CRUD BusinessProfile (**multiple profiles**)
- CRUD Offer (scoped to profile)

### Етап 3 — Контент
- CRUD PortfolioPost
- CRUD Story + авто‑протухання

### Етап 4 — Угоди + відгуки
- ✅ (MVP) Провайдер вручну створює угоду у кабінеті (вказує email клієнта, опційно — офер)
- ✅ Зміна статусів угоди: draft → in_progress → completed або cancelled
- ✅ Відгук після `completed` (клієнт; 1 відгук на deal; policy + UI + tests)

### Етап 5 — Полірування
- UI polish
- paging/filters
- тестування
- ✅ (частково) Полірування каталогу:
  - debounce для пошуку/міста
  - пагінація з номерами сторінок
  - чіпи активних фільтрів
  - фільтр ціни (діапазон) + опція включати «ціна за домовленістю»
  - оптимізація city-filter (prefix search + індекс `lower(city)`)
